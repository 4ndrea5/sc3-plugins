<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.48">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #ad140d}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
span.s1 {color: #001bb9}
span.s2 {color: #ad140d}
span.s3 {color: #000000}
span.s4 {color: #2c7014}
span.s5 {color: #0000bf}
span.s6 {color: #007300}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>SMS<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Spectral Modeling Synthesis</b></p>
<p class="p2"><br></p>
<p class="p3"><b>resynthesis = SMS.ar(input,maxpeaks=80, currentpeaks, tolerance=4, noisefloor= 0.2, freqmult=1.0, freqadd=0.0, formantpreserve=0, useifft=0, ampmult=1.0, mul=1.0, add=0.0)</b></p>
<p class="p2"><br></p>
<p class="p3">An implementation of the sines+noise model first described by Xavier Serra in his 1989 PhD thesis; an input sound is analysed in terms of sinusoidal components by a peak tracking phase vocoder. The error between the sinusoidal reconstruction and the original signal (the residual) is then modeled by a noise model of filtered white noise. The sines part and the noise part are separately resynthesised, allowing independent transformations. <span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p3">For technical details see:</p>
<p class="p2"><br></p>
<p class="p3">Xavier Serra and Julius O. Smith (1990) "Spectral Modeling Synthesis: A Sound Analysis/Synthesis System Based on a Deterministic plus Stochastic Decomposition". Computer Music Journal 14(4): 12--24</p>
<p class="p2"><br></p>
<p class="p3">Note that this plugin assumes block size of 64 and is optimised for 44100 sampling rate (internally, it uses 1024 point FFTs).<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p3"><b>input- </b>Audio rate input to be analysed</p>
<p class="p3"><b>maxpeaks- </b>Absolute maximum number of allowed peaks to be detected in the spectrum</p>
<p class="p3"><b>currentpeaks- </b>Current number of allowed peaks to be detected in the spectrum</p>
<p class="p3"><b>tolerance- </b>Search area for matching peaks; within tolerance spectral bins</p>
<p class="p3"><b>noisefloor- </b>Minimum magnitude for a candidate peak (measured as spectral magnitude)</p>
<p class="p3"><b>freqmult- </b>Resynthesis parameter to change frequency; currently causes a gross multiplication of frequency of all sinusoidal components</p>
<p class="p3"><b>freqadd- </b>Resynthesis parameter to change frequency; currently causes a gross addition of a frequency to all sinusoidal components</p>
<p class="p3"><b>formantpreserve- </b>Even if changing the frequencies of sinusoidal partial tracks, re-impose the original magnitude spectrum so as to keep the formants (spectral envelope preservation). 0 is off, otherwise on (there is a small performance hit).<span class="Apple-converted-space"> </span></p>
<p class="p3"><b>useifft- </b>Use IFFT based resynthesis, which is lower quality, but substantially more efficient</p>
<p class="p3"><b>ampmult- </b>amplitude multiplier for internal compensation for window power loss within algorithm. Usually leave as default of 1.0.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">//sine reconstruction left channel, noises on right</p>
<p class="p6">(<span class="Apple-converted-space"> </span></p>
<p class="p6">{<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in= <span class="s1">SoundIn</span>.ar(0); <span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>output=<span class="s1">SMS</span>.ar(in, 50,<span class="s1">MouseY</span>.kr(1,50), 8, 0.3);<span class="Apple-converted-space">  </span><span class="s2">//or freqmult: MouseX.kr(0.5,4)</span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>output<span class="Apple-converted-space"> </span></p>
<p class="p6">}.play<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-converted-space"> </span></p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">//just noise residual</p>
<p class="p4"><br></p>
<p class="p7"><span class="s3">d=</span><span class="s1">Buffer</span><span class="s3">.read(s,</span>"sounds/a11wlk01.wav"<span class="s3">);</span></p>
<p class="p4"><br></p>
<p class="p6">(<span class="Apple-converted-space"> </span></p>
<p class="p6">{<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in=<span class="s1">PlayBuf</span>.ar(1,d,<span class="s1">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>output=<span class="s1">SMS</span>.ar(in, 50,50, <span class="s1">MouseX</span>.kr(1.0,10.0).round(1.0),<span class="s1">MouseY</span>.kr(0.1,20.0,<span class="s4">'exponential'</span>), 1.0); <span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(0,<span class="s1">Pan2</span>.ar(output[1]));<span class="Apple-converted-space"> </span></p>
<p class="p6">}.play<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-converted-space"> </span></p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p8"><br></p>
<p class="p9">//frequency multiplication and shift with formant preservation</p>
<p class="p8"><br></p>
<p class="p10">(<span class="Apple-converted-space"> </span></p>
<p class="p10">{<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>in=<span class="s5">PlayBuf</span>.ar(1,d,<span class="s5">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>output=<span class="s5">SMS</span>.ar(in, 60,60, 4.0,0.2, <span class="s5">MouseX</span>.kr(0.5,4), <span class="s5">MouseY</span>.kr(0,1000), 1.0); <span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(0,Pan2.ar(output[0]));<span class="Apple-converted-space"> </span></p>
<p class="p10">}.play<span class="Apple-converted-space"> </span></p>
<p class="p10">)<span class="Apple-converted-space"> </span></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">//transient detection via Pitch hasFreq output</p>
<p class="p5">//could have freq input and transient detection input to SMS to control rendering <span class="Apple-converted-space"> </span></p>
<p class="p6">(</p>
<p class="p6">{</p>
<p class="p4"><br></p>
<p class="p6"><span class="s1">var</span> in, fft, sines, noise, freq, hasFreq;</p>
<p class="p4"><br></p>
<p class="p5">//in= SoundIn.ar(0);<span class="Apple-converted-space"> </span></p>
<p class="p6">in=<span class="s1">PlayBuf</span>.ar(1,d,<span class="s1">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p4"><br></p>
<p class="p6">#freq, hasFreq= <span class="s1">Pitch</span>.kr(in); <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">#sines, noise=<span class="s1">SMS</span>.ar(in, 50,50, 8, 1.0, <span class="s1">MouseX</span>.kr(0.5,4));<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6"><span class="s1">Pan2</span>.ar(sines*(hasFreq.lag(0.01,0.01)) + <span class="s1">LPF</span>.ar(noise,<span class="s1">MouseY</span>.kr(100,10000,<span class="s4">'exponential'</span>)),0.0)</p>
<p class="p6">}.play</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">//alternative; only pass into SMS if not a transient region</p>
<p class="p6">(</p>
<p class="p6">{</p>
<p class="p4"><br></p>
<p class="p6"><span class="s1">var</span> in, fft, sines, noise, freq, hasFreq;</p>
<p class="p4"><br></p>
<p class="p5">//in= SoundIn.ar(0);<span class="Apple-converted-space"> </span></p>
<p class="p6">in=<span class="s1">PlayBuf</span>.ar(1,d,<span class="s1">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p4"><br></p>
<p class="p6">#freq, hasFreq= <span class="s1">Pitch</span>.kr(in); <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">#sines, noise=<span class="s1">SMS</span>.ar(if(hasFreq,in, <span class="s1">Silent</span>.ar), 50,50, 8, 1.0, <span class="s1">MouseX</span>.kr(0.5,4));<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">if(hasFreq,<span class="s1">Pan2</span>.ar(sines + <span class="s1">LPF</span>.ar(noise,<span class="s1">MouseY</span>.kr(100,10000,<span class="s4">'exponential'</span>)), 0.0),0.25*in)</p>
<p class="p4"><br></p>
<p class="p6">}.play</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p8"><br></p>
<p class="p9">//having fun</p>
<p class="p10">(<span class="Apple-converted-space"> </span></p>
<p class="p10">{<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>in=<span class="s5">PlayBuf</span>.ar(1,d,<span class="s5">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>output=<span class="s5">SMS</span>.ar(in, 60,60, 4.0,0.2, <span class="s5">MouseX</span>.kr(0.5,4), <span class="s5">MouseY</span>.kr(0.0001,10000,<span class="s6">'exponential'</span>), <span class="s5">LFNoise0</span>.kr(2,0.5,0.5).round(1)); <span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(0,<span class="s5">Pan2</span>.ar(<span class="s5">AllpassC</span>.ar(output[0],0.05,<span class="s5">LFNoise2</span>.kr(10,0.02,0.025),0.5) + <span class="s5">CombL</span>.ar(output[1],0.1,0.1,2),0.0));<span class="Apple-converted-space"> </span></p>
<p class="p10">}.play<span class="Apple-converted-space"> </span></p>
<p class="p10">)</p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p4"><br></p>
<p class="p9">//having even more fun</p>
<p class="p10">(<span class="Apple-converted-space"> </span></p>
<p class="p10">{<span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>in=<span class="s5">SoundIn</span>.ar(0);</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>output=<span class="s5">SMS</span>.ar(in, 60,60, 4.0,0.1, <span class="s5">MouseX</span>.kr(0.01,10), <span class="s5">MouseY</span>.kr(-1000,1000), 0.0); <span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(0,<span class="s5">Pan2</span>.ar(<span class="s5">CombL</span>.ar(output[1],0.02,0.02,0.5) + output[0]));<span class="Apple-converted-space"> </span></p>
<p class="p10">}.play<span class="Apple-converted-space"> </span></p>
<p class="p10">)</p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p9">//testing IFFT resynthesis</p>
<p class="p10">(<span class="Apple-converted-space"> </span></p>
<p class="p10">{<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>in=<span class="s5">PlayBuf</span>.ar(1,d,<span class="s5">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span>output=<span class="s5">SMS</span>.ar(in, 300,<span class="s5">MouseY</span>.kr(1,300), 10.0,0.01, <span class="s5">MouseX</span>.kr(0.5,4), 0, 1.0, 1); <span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(0,output);<span class="Apple-converted-space"> </span></p>
<p class="p10">}.play<span class="Apple-converted-space"> </span></p>
<p class="p10">)<span class="Apple-converted-space"> </span></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p5">//just<span class="Apple-converted-space">  </span>sines</p>
<p class="p4"><br></p>
<p class="p6">(<span class="Apple-converted-space"> </span></p>
<p class="p6">{<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in=<span class="s1">PlayBuf</span>.ar(1,d,<span class="s1">BufRateScale</span>.kr(d),1,0,1);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>output=<span class="s1">SMS</span>.ar(in, 500,500, <span class="s1">MouseX</span>.kr(1.0,10.0).round(1.0),<span class="s1">MouseY</span>.kr(0.001,20.0,<span class="s4">'exponential'</span>), 1.0, 1.0,0,1); <span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(0,<span class="s1">Pan2</span>.ar(output[0]));<span class="Apple-converted-space"> </span></p>
<p class="p6">}.play<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-converted-space"> </span></p>
<p class="p6">)</p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p9">//having even more fun, this time with IFFT</p>
<p class="p6">(<span class="Apple-converted-space"> </span></p>
<p class="p6">{<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s5">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in=<span class="s5">SoundIn</span>.ar(0);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>output=<span class="s5">SMS</span>.ar(in, 200,200, 4.0,0.1, <span class="s5">MouseX</span>.kr(0.01,10), <span class="s5">MouseY</span>.kr(-1000,1000), 0.0, useifft:1); <span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(0,<span class="s5">Pan2</span>.ar(<span class="s5">CombL</span>.ar(output[1],0.02,0.02,0.5) + output[0]));<span class="Apple-converted-space"> </span></p>
<p class="p6">}.play<span class="Apple-converted-space"> </span></p>
<p class="p6">)</p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p4"><br></p>
<p class="p9">//experimenting with ampmult</p>
<p class="p6">(<span class="Apple-converted-space"> </span></p>
<p class="p6">{<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s5">var</span> in, fft, output;<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span> <span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in=<span class="s5">SoundIn</span>.ar(0);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>output=<span class="s5">SMS</span>.ar(in, 200,200, 4.0,0.01,<span class="s5">MouseY</span>.kr(0.01,100,'exponential'),0, formantpreserve:1.0, useifft:1, ampmult:MouseX.kr(0.0,10.0)); <span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(0,<span class="s5">output</span>);<span class="Apple-converted-space"> </span></p>
<p class="p6">}.play<span class="Apple-converted-space"> </span></p>
<p class="p6">)</p>
<p class="p8"><br></p>
<p class="p8"><br></p>
</body>
</html>
