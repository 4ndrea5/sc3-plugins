#!/bin/bash
# Combined distro script for Mac & Linux (and others...?)
# made by various people: blackrain, Andrzej Kopec, Dan Stowell, nescivi

case `uname` in
	Darwin) echo "running distro script for Mac OSX";pluginext='scx';movecmd=cp;;
	*)      echo "running distro script for Linux";  pluginext='so'; movecmd=mv;;
esac

if [ -d .svn ]; then
	svn export --force build Extensions
else
	cp -uR build Extensions
fi

$movecmd build/BatUGens.$pluginext       Extensions/BatUGens
$movecmd build/Bhob*.$pluginext          Extensions/BhobUGens
$movecmd build/BlackrainUGens*.$pluginext Extensions/BlackrainUGens
$movecmd build/Josh*UGens*.$pluginext    Extensions/JoshUGens
$movecmd build/LadspaUGens.$pluginext    Extensions/LadspaUGens
$movecmd build/LoopBuf.$pluginext        Extensions/LoopBufUGens
$movecmd build/MCLD*UGens*.$pluginext    Extensions/MCLDUGens
$movecmd build/MdaUGens.$pluginext       Extensions/MdaUGens
$movecmd build/MembraneUGens.$pluginext  Extensions/MembraneUGens
$movecmd build/MLfftwUGens*.$pluginext   Extensions/MLfftwUGens
$movecmd build/RMEQSuiteUGens.$pluginext       Extensions/RMEQSuiteUGens
$movecmd build/RFWUGens.$pluginext       Extensions/RFWUGens
$movecmd build/SLUGens*.$pluginext       Extensions/SLUGens
if [ -f build/STKUGens*.$pluginext ]; then
	$movecmd build/STKUGens*.$pluginext      Extensions/StkUGens
fi
if [ -f build/TagSystemUgens.$pluginext ]; then
	$movecmd build/TagSystemUgens.$pluginext Extensions/TagSystemUGens
fi
if [ -f build/AY*.$pluginext ]; then
	$movecmd build/AY*.$pluginext            Extensions/AYUGens
fi

# License always important
cp license.txt Extensions/license.txt

mkdir -p Extensions/test

if [ `uname` = Darwin ]; then
	# Deactivate wonky
	mv Extensions/StkUGens Extensions/test
	
	# Add the readme
	cp Resources/README-for-mac-distro.txt Extensions/README.txt
	
	# Now let's make the disk image
	hdiutil create -srcfolder Extensions "SC3ExtPlugins`date +%Y-%m-%d`.dmg" -volname "SC3-plugins"
fi

if [ `uname` = Linux ]; then
	# Deactivate wonky
	mv Extensions/MCLDUGens/MCLD_CQ_UGens.sc Extensions/test
fi

echo 'distro done.'
